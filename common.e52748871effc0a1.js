"use strict";(self.webpackChunkblog_app=self.webpackChunkblog_app||[]).push([[76],{3933:(D,v,i)=>{i.d(v,{D:()=>y});var c=i(3107),n=i(4522),h=i(3756),r=i(2695),b=i(4159),m=i(8915),_=i(3016),g=i(7947),d=i(7178),o=i(2867),u=i(7082),p=i(480);let y=(()=>{class t{firestore=(0,c.WQX)(n._7);functions=(0,c.WQX)(r.ah);authService=(0,c.WQX)(u.u);errorService=(0,c.WQX)(p.I);getUsers(e=100){const s=(0,n.rJ)(this.firestore,"users"),l=(0,n.P)(s,(0,n.My)("displayName"),(0,n.AB)(e));return(0,b.H)((0,n.GG)(l)).pipe((0,g.T)(E=>E.docs.map(f=>({uid:f.id,...f.data(),isActive:f.data().isActive??!0,createdAt:f.data().createdAt?.toDate(),updatedAt:f.data().updatedAt?.toDate()}))),(0,d.W)(E=>(this.errorService.showError("Error loading users"),(0,m.$)(()=>new Error(E)))))}getUserById(e){const s=(0,n.x7)((0,n.H9)(this.firestore,"users",e));return(0,b.H)(s).pipe((0,g.T)(l=>l.exists()?{uid:l.id,...l.data(),isActive:l.data().isActive??!0,createdAt:l.data().createdAt?.toDate(),updatedAt:l.data().updatedAt?.toDate()}:null),(0,d.W)(l=>(this.errorService.showError("Error loading user details"),(0,m.$)(()=>new Error(l)))))}updateUserRole(e,s){return this.authService.profile$.pipe((0,o.n)(l=>{if(!l||"admin"!==l.role)return this.errorService.showError("Permission denied: Only admins can change roles"),(0,m.$)(()=>new Error("Permission denied"));const E=(0,n.H9)(this.firestore,"users",e),f=(0,n.mZ)(E,{role:s,updatedAt:(0,h.O5)()}),C=(0,r.Qg)(this.functions,"setCustomUserClaims")({uid:e,claims:this.getRoleClaims(s)});return(0,b.H)(Promise.all([f,C])).pipe((0,g.T)(()=>{}),(0,d.W)(A=>(this.errorService.showError("Failed to update role"),(0,m.$)(()=>new Error(A)))))}))}activateUser(e){return this.validateAdmin().pipe((0,o.n)(()=>{const s=(0,n.H9)(this.firestore,"users",e);return(0,b.H)((0,n.mZ)(s,{isActive:!0,updatedAt:(0,h.O5)()}))}),(0,d.W)(s=>(this.errorService.showError("Failed to activate user"),(0,m.$)(()=>new Error(s)))))}deactivateUser(e){return this.validateAdmin().pipe((0,o.n)(()=>{const s=(0,n.H9)(this.firestore,"users",e);return(0,b.H)((0,n.mZ)(s,{isActive:!1,updatedAt:(0,h.O5)()}))}),(0,d.W)(s=>(this.errorService.showError("Failed to deactivate user"),(0,m.$)(()=>new Error(s)))))}validateAdmin(){return this.authService.profile$.pipe((0,o.n)(e=>e&&"admin"===e.role?(0,_.of)(void 0):(0,m.$)(()=>new Error("Admin privileges required"))))}getRoleClaims(e){return{admin:"admin"===e,author:"author"===e||"admin"===e}}static \u0275fac=function(s){return new(s||t)};static \u0275prov=c.jDH({token:t,factory:t.\u0275fac,providedIn:"root"})}return t})()},4032:(D,v,i)=>{i.d(v,{Y:()=>_});var c=i(3107),n=i(2902),h=i(8559);let _=(()=>{class g{static \u0275fac=function(u){return new(u||g)};static \u0275mod=c.$C({type:g});static \u0275inj=c.G2t({imports:[h.Pd,n.yE,n.yE]})}return g})()},5734:(D,v,i)=>{i.r(v),i.d(v,{SitemapXmlComponent:()=>u});var c=i(3014),n=i(3107),h=i(4460),r=i(7691),b=i(4466),m=i(3234),_=i(8747),g=i(1540);function d(p,y){const t="object"==typeof y;return new Promise((a,e)=>{const s=new g.Ms({next:l=>{a(l),s.unsubscribe()},error:e,complete:()=>{t?a(y.defaultValue):e(new _.G)}});p.subscribe(s)})}let o=(()=>{class p{blogService=(0,n.WQX)(b.c);http=(0,n.WQX)(r.Qq);baseUrl=m.c.production?"https://blog.beaubuckman.com":"http://localhost:4200";generateSitemapXml(){var t=this;return(0,c.A)(function*(){const a=yield t.collectSitemapUrls();return t.formatXmlSitemap(a)})()}collectSitemapUrls(){var t=this;return(0,c.A)(function*(){return[...t.getStaticUrls(),...yield t.getDynamicUrls()]})()}getStaticUrls(){const t=(new Date).toISOString().split("T")[0];return[{loc:`${this.baseUrl}/`,lastmod:t,changefreq:"daily",priority:1},{loc:`${this.baseUrl}/blog`,lastmod:t,changefreq:"daily",priority:.9},{loc:`${this.baseUrl}/auth/login`,lastmod:t,changefreq:"monthly",priority:.5},{loc:`${this.baseUrl}/auth/signup`,lastmod:t,changefreq:"monthly",priority:.5},{loc:`${this.baseUrl}/legal/privacy-policy`,lastmod:t,changefreq:"yearly",priority:.3},{loc:`${this.baseUrl}/sitemap`,lastmod:t,changefreq:"weekly",priority:.2}]}getDynamicUrls(){var t=this;return(0,c.A)(function*(){try{return(yield t.blogService.getPublishedPosts()).map(e=>{let s;return s=e.updatedAt?(e.updatedAt.toDate?e.updatedAt.toDate():new Date(e.updatedAt)).toISOString().split("T")[0]:e.publishedAt?(e.publishedAt.toDate?e.publishedAt.toDate():new Date(e.publishedAt)).toISOString().split("T")[0]:(new Date).toISOString().split("T")[0],{loc:`${t.baseUrl}/blog/${e.id}`,lastmod:s,changefreq:"weekly",priority:.8}})}catch(a){return console.error("Error getting dynamic URLs for sitemap:",a),[]}})()}formatXmlSitemap(t){let a='<?xml version="1.0" encoding="UTF-8"?>\n';return a+='<urlset xmlns="http://www.sitemaps.org/schemas/sitemap/0.9">\n',t.forEach(e=>{a+="  <url>\n",a+=`    <loc>${this.escapeXml(e.loc)}</loc>\n`,e.lastmod&&(a+=`    <lastmod>${e.lastmod}</lastmod>\n`),e.changefreq&&(a+=`    <changefreq>${e.changefreq}</changefreq>\n`),void 0!==e.priority&&(a+=`    <priority>${e.priority.toFixed(1)}</priority>\n`),a+="  </url>\n"}),a+="</urlset>",a}escapeXml(t){return t.replace(/[&<>"']/g,a=>{switch(a){case"&":return"&amp;";case"<":return"&lt;";case">":return"&gt;";case'"':return"&quot;";case"'":return"&apos;";default:return a}})}submitSitemapToSearchEngines(){var t=this;return(0,c.A)(function*(){if(!m.c.production)return void console.log("Skipping sitemap submission in development mode");const a=`${t.baseUrl}/sitemap.xml`;try{const e=`https://www.google.com/ping?sitemap=${encodeURIComponent(a)}`;yield d(t.http.get(e)),console.log("Sitemap submitted to Google");const s=`https://www.bing.com/ping?sitemap=${encodeURIComponent(a)}`;yield d(t.http.get(s)),console.log("Sitemap submitted to Bing")}catch(e){console.error("Error submitting sitemap to search engines:",e)}})()}static \u0275fac=function(a){return new(a||p)};static \u0275prov=n.jDH({token:p,factory:p.\u0275fac,providedIn:"root"})}return p})(),u=(()=>{class p{sitemapService=(0,n.WQX)(o);xmlContent="";ngOnInit(){this.generateSitemap()}generateSitemap(){var t=this;return(0,c.A)(function*(){try{if(t.xmlContent=yield t.sitemapService.generateSitemapXml(),typeof document<"u"){const a=document.createElement("meta");a.httpEquiv="Content-Type",a.content="application/xml; charset=utf-8",document.head.appendChild(a)}}catch(a){console.error("Error generating sitemap XML:",a),t.xmlContent="\x3c!-- Error generating sitemap --\x3e"}})()}static \u0275fac=function(a){return new(a||p)};static \u0275cmp=n.VBU({type:p,selectors:[["app-sitemap-xml"]],decls:3,vars:1,consts:[[1,"xml-container"]],template:function(a,e){1&a&&(n.j41(0,"div",0)(1,"pre"),n.EFF(2),n.k0s()()),2&a&&(n.R7$(2),n.JRh(e.xmlContent))},dependencies:[h.MD],styles:[".xml-container[_ngcontent-%COMP%]{display:none}"]})}return p})()},6927:(D,v,i)=>{i.d(v,{w:()=>b});var c=i(4460),n=i(7544),h=i(9471),r=i(3107);let b=(()=>{class m{dialogRef;data;constructor(g,d){this.dialogRef=g,this.data=d}static \u0275fac=function(d){return new(d||m)(r.rXU(n.CP),r.rXU(n.Vh))};static \u0275cmp=r.VBU({type:m,selectors:[["app-confirm-dialog"]],decls:10,vars:6,consts:[["mat-dialog-title",""],["align","end"],["mat-button","","mat-dialog-close",""],["mat-raised-button","",3,"color","mat-dialog-close"]],template:function(d,o){1&d&&(r.j41(0,"h2",0),r.EFF(1),r.k0s(),r.j41(2,"mat-dialog-content")(3,"p"),r.EFF(4),r.k0s()(),r.j41(5,"mat-dialog-actions",1)(6,"button",2),r.EFF(7),r.k0s(),r.j41(8,"button",3),r.EFF(9),r.k0s()()),2&d&&(r.R7$(),r.JRh(o.data.title),r.R7$(3),r.JRh(o.data.message),r.R7$(3),r.JRh(o.data.cancelButton||"Cancel"),r.R7$(),r.Y8G("color",o.data.color||"primary")("mat-dialog-close",!0),r.R7$(),r.SpI(" ",o.data.confirmButton||"Confirm"," "))},dependencies:[c.MD,n.hM,n.tx,n.BI,n.E7,n.Yi,h.Hl,h.$z],styles:[".mat-dialog-title[_ngcontent-%COMP%]{margin:0 0 16px}.mat-dialog-content[_ngcontent-%COMP%]{margin:0 0 24px}.mat-dialog-actions[_ngcontent-%COMP%]{padding:16px 0 0}"]})}return m})()}}]);